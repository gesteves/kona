<div
  class="comments"
  id="comments"
  data-controller="comments"
  data-comments-author-did-value="<%= article.author.bluesky_did %>"
  data-comments-url-value="<%= article.bluesky_comments_url %>"
  data-comments-at-uri-value="<%= article.bluesky_comments_at_uri %>"
  data-comments-depth-value="<%= ENV.fetch('BLUESKY_COMMENTS_DEPTH', 6) %>"
  data-comments-parent-height-value="<%= ENV.fetch('BLUESKY_COMMENTS_HEIGHT', 1000) %>"
  data-comments-sort-value="<%= ENV.fetch('BLUESKY_COMMENTS_SORT', 'likes').strip.downcase %>"
>
  <h3 class="comments__heading">Comments</h3>
  <div class="comments__spinner" data-comments-target="spinner">
    <%= icon_svg "classic", "solid", "circle-notch" %>
  </div>
  <p class="is-hidden" data-comments-target="prompt"><a href="<%= article.bluesky_comments_url %>" rel="noreferrer noopener nofollow">Reply on Bluesky</a> to join the conversation.</p>
  <p class="is-hidden" data-comments-target="firstComment">No comments yet! <a href="<%= article.bluesky_comments_url %>" rel="noreferrer noopener nofollow">Reply on Bluesky</a> to start the conversation.</p>
  <p class="is-hidden" data-comments-target="error">Oops, comments failed to load. Please reload the page to try again.</p>

  <script data-comments-target="commentTemplate" type="text/x-handlebars-template">
    <article class="comments__comment comments__comment--depth-{{depth}}">
      {{#if avatar}}
      <a href="{{postLink}}" class="comments__avatar-link" target="_blank" rel="noreferrer noopener nofollow">
        <img class="comments__avatar" src="{{avatar}}" alt="{{displayName}}â€™s avatar">
      </a>
      {{/if}}
      <div class="comments__content">
        <div class="comments__header">
          {{#if isAuthor}}
            <%= icon_svg "classic", "solid", "badge-check" %>
          {{/if}}
          <a href="{{authorProfileLink}}" target="_blank" rel="noreferrer noopener nofollow">
            <span class="comments__author-name">{{displayName}}</span>
            @{{handle}}
          </a>
          <a class="comments__timestamp" href="{{postLink}}" target="_blank" rel="noreferrer noopener nofollow" title="{{timestamp}}">{{relativeTimestamp}}</a>
        </div>
        <p class="comments__text">{{text}}</p>
        <div class="comments__meta">
          <span class="comments__meta-item" aria-label="{{replyCount}} replies"><%= icon_svg "classic", "regular", "comment" %> {{replyCount}}</span>
          <span class="comments__meta-item" aria-label="{{repostCount}} reposts"><%= icon_svg "classic", "regular", "retweet" %> {{repostCount}}</span>
          <span class="comments__meta-item" aria-label="{{likeCount}} likes"><%= icon_svg "classic", "regular", "heart" %> {{likeCount}}</span>
        </div>
        {{#if seeMoreComments}}
        <a href="{{postLink}}" class="comments__see-more" target="_blank" rel="noreferrer noopener nofollow">Continue this thread on Bluesky</a>
        {{/if}}
      </div>
    </article>
  </script>
</div>
